---
title: 1. 大模型api简单示例
date: 2025-09-05 9:56:29
permalink: /api-simple-example/
sidebar: true
article: true
author: 
  name: xiao_sl
  link: https://github.com/xiaosl-cell
categories: 
  - 基础知识
tags: 
  - llm调用
---

大模型API是指大模型（如自然语言处理模型、图像生成模型等）对外开放的应用程序接口（API）。开发者可以通过这些API，将大模型的能力集成到自己的应用中，以提高自身应用的智能化水平。

## 1.1 获取并配置API访问密钥（API Key）

首先，需要在提供大模型API服务的平台（如 OpenAI、DeepSeek、Hugging Face、Azure、Google Cloud等）注册并获取 API 密钥。这些平台会为每个账户生成一个唯一的API密钥，作为对服务的身份认证。

## 1.2 安装所需的 SDK 或库

以 Python 调用 OpenAI 为例，配置好python环境后安装 Python 客户端库。

```bash
pip install openai
```

## 1.3 编写代码

按照官方文档编写代码。以下为国内某代理提供的示例，为了安全，API_KEY与URL相关参数可以配置在环境变量中。

```python
from openai import OpenAI

client = OpenAI(
    api_key = "自己的API key",
    base_url = "模型提供API的URL"
)

chat_completion = client.chat.completions.create(
    messages=[
        {
            "role": "user",
            "content": "你好？",
        }
    ],
    model="gpt-4o-mini", # 此处更换其它模型,请参考模型列表
)

print(chat_completion.choices[0].message.content)
```

## 1.4 API 接口兼容性

目前常用的大模型调用几乎都兼容了openai库，所以其他模型套路也几乎一致，在个别支持的功能上有细微差异，详细参见各大模型的API接入文档，本文内容以GPT为示例。

## 1.5 系统环境变量配置

为了提高安全性和便于管理，建议将 API 密钥和其他敏感信息配置为环境变量，而不是硬编码在代码中。

### 1.5.1 Windows 系统配置

**方法一：命令行临时设置**
```cmd
set OPENAI_API_KEY=your-api-key-here
set OPENAI_BASE_URL=https://api.openai.com/v1
```

**方法二：PowerShell 设置**
```powershell
$env:OPENAI_API_KEY="your-api-key-here"
$env:OPENAI_BASE_URL="https://api.openai.com/v1"
```

**方法三：系统环境变量（永久设置）**
1. 右键"此电脑" → "属性" → "高级系统设置"
2. 点击"环境变量"按钮
3. 在"用户变量"或"系统变量"中点击"新建"
4. 变量名：`OPENAI_API_KEY`，变量值：你的API密钥
5. 同样方式添加 `OPENAI_BASE_URL` 变量

### 1.5.2 Linux/macOS 系统配置

**临时设置（当前会话有效）**
```bash
export OPENAI_API_KEY="your-api-key-here"
export OPENAI_BASE_URL="https://api.openai.com/v1"
```

**永久设置**
```bash
# 编辑 ~/.bashrc 或 ~/.zshrc 文件
echo 'export OPENAI_API_KEY="your-api-key-here"' >> ~/.bashrc
echo 'export OPENAI_BASE_URL="https://api.openai.com/v1"' >> ~/.bashrc

# 重新加载配置
source ~/.bashrc
```

### 1.5.3 Python 代码中使用环境变量

```python
import os
from openai import OpenAI

# 从环境变量读取配置
client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
    base_url=os.getenv("OPENAI_BASE_URL", "https://api.openai.com/v1")  # 提供默认值
)

# 检查环境变量是否设置
if not os.getenv("OPENAI_API_KEY"):
    raise ValueError("请设置 OPENAI_API_KEY 环境变量")

chat_completion = client.chat.completions.create(
    messages=[
        {
            "role": "user",
            "content": "你好？",
        }
    ],
    model="gpt-4o-mini",
)

print(chat_completion.choices[0].message.content)
```

### 1.5.4 使用 .env 文件（推荐）

**安装 python-dotenv**
```bash
pip install python-dotenv
```

**创建 .env 文件**
```env
# .env 文件内容
OPENAI_API_KEY=your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
MODEL_NAME=gpt-4o-mini
```

**Python 代码中加载 .env 文件**
```python
import os
from dotenv import load_dotenv
from openai import OpenAI

# 加载 .env 文件
load_dotenv()

client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
    base_url=os.getenv("OPENAI_BASE_URL")
)

chat_completion = client.chat.completions.create(
    messages=[
        {
            "role": "user",
            "content": "你好？",
        }
    ],
    model=os.getenv("MODEL_NAME", "gpt-4o-mini"),  # 从环境变量读取模型名
)

print(chat_completion.choices[0].message.content)
```

### 1.5.5 安全注意事项

- **不要将 .env 文件提交到版本控制系统**：在 `.gitignore` 中添加 `.env`
- **定期轮换 API 密钥**：建议每 3-6 个月更换一次
- **使用最小权限原则**：只授予必要的 API 权限
- **监控 API 使用情况**：定期检查 API 调用日志和费用

```gitignore
# .gitignore 文件示例
.env
.env.local
.env.*.local
*.key
config/secrets.json
```